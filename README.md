# Super-Resolution Model as a Data Augmentation Method in Convolutional Neural Networks

(Link for Master's thesis coming)

Oona Leppänen

The code used in my Master's Thesis that was done for University of Turku. I tested how a super-resolution diffusion model performs as a data augmentation method when a CNN is trained with data generated by the diffusion model and compared to CNNs that were trained with high- and low-resolution data.

The diffusion model part of the Thesis was built on [SeeSR](https://github.com/cswry/SeeSR) diffusion model by Rongyuan Wu et al. See Acknowledgement section for this and other acknoledgements.

## Instructions for installing and using the code

**Clone this repository:**
```
git clone https://github.com/Oona-Leppanen/SR-Diffusion-Model-as-a-Data-Augmentation-Method-in-CNN
cd SR-Diffusion-Model-as-a-Data-Augmentation-Method-in-CNN
```
**Installation and utilization:**

The provided code can be utilized in multiple ways:
1. using the same process done in my thesis
2. using only data preprocessing
3. using only the modified diffusion model
4. using only the CNN classifier (training)
5. using only the CNN classifier (classification)
6. using the modified diffusion model and evaluating it

Each of these are discussed in the following sections A-D.
- Case 1: read all sections (A-D) in the corresponding order.
- Case 2: read section A.
- Case 3: read section B.
- Case 4: read section C1 in C.
- Case 5: read section C2 in C.
- Case 6: read section D.

### Section A: Usage of the data preprocessing components

First, you have to find or create a high-resolution classification dataset. When your dataset is ready, follow the next steps:

1. Change the input and output file paths in split_hr_data_train_valid_test file (Diffusion_model_and_other_thesis_files -> Thesis) to match your paths. The input path should be the path to your high-resolution dataset and the output path should lead to any folder where you want to save your split high-resolution dataset.

2.  Change the input and output file paths in rescale_images_to_lr file (Diffusion_model_and_other_thesis_files -> Thesis) to match your paths. The input path should be the path to your split high-resolution dataset and the output path should lead to any folder where you want to save your low-resolution dataset.

3. Run the "High-resolution data" and "Low-resolution data" sections in Preparing_high_low_and_cropped_datasets file (Meta files for running Python files folder), respectively, to achieve the split version and low-resolution version of your high-resolution dataset.

### Section B: Usage of diffusion model

Because the used diffusion model is a modification of [SeeSR](https://github.com/cswry/SeeSR) model, it is not offered in this project page entirely but the missing pieces can be found and downloaded from [SeeSR](https://github.com/cswry/SeeSR) link and [CCSR](https://github.com/csslc/CCSR?tab=readme-ov-file) link (download only VAE of the CCSR model). This modified model utilizes the VAE component used in the [CCSR](https://github.com/csslc/CCSR?tab=readme-ov-file) model. See Acknowledgement section below.

1. Download [SeeSR](https://github.com/cswry/SeeSR) as instructed in its Github page.
	- NOTICE! Use package list given in this repository. It goes by name
		diffusion_model_requirements (Diffusion_model_and_other_thesis_files). Using the list given in [SeeSR](https://github.com/cswry/SeeSR)	leads to a missing package problems.
	- To avoid problems, use the file_for_running_seesr_versions file (Meta files for running Python files) for correct package and import loads and usage of the diffusion	model.

2. Read the ReadMe file in models folder in ram folder. Replace the utils.py file of the SeeSR model as instructed in the ReadMe in models folder in ram folder.

3. Add all files and Thesis folder in SeeSR_main folder. (No ram folder!)

4. Download the checkpoints of VAE of the [CCSR](https://github.com/csslc/CCSR) model from Quick Inference section. To download the checkpoints straight away, go to [CCSR Google Drive](https://drive.google.com/drive/folders/1yHfMV81Md6db4StHTP5MC-eSeLFeBKm8). Download all the files and place them in the CCSR_VAE_checkpoints folder (Diffusion_model_and_other_thesis_files -> Thesis -> models).

5. Change input and output paths in the seesr_with_ccsr_vae file (Diffusion_model_and_other_thesis_files). The input path should be the path to your low-resolution dataset and the output path should lead to any folder where you want to save super-resolution dataset generated by the diffusion model.

6. Run "Package Installations" and "SeeSR with CCSR VAE" sections of the file_for_running_seesr_versions file (Meta files for running Python files folder) to generate the super-resolution dataset.

### Section C: Usage of the CNN classifier

**Section C1: Training CNN classifiers for a/all dataset(s)**

1. Change input and output paths given in the cnn_classifier file (CNN_classifier) to your paths. Make sure all paths are changed! There are lots of paths in the code, so change all paths you need.

2. Run "Imports" and "Set up" sections and all other sections you want. Notice that "McNemar's Test" section needs all three CNN classifiers to be trained.

**Section C2: Using pretrained classifiers**

1. Change input and output paths given in the cnn_classifier file (CNN_classifier)to your paths. Make sure all paths are changed! There are lots of paths in the code, so change all paths you need.

2. Run "Imports", "Initializing Dataset Loading" in "Set up", the "Loading the Dataset" and "Prediction and Performance Metrics" in the wanted CNN model section such as in "Low-Resolution CNN Model" (cnn_classifier file). This way you receive predictions for the dataset(s) you inputted to the CNN model(s).

### Section D: Evaluation of the diffusion model

1. Set up the diffusion model as described in parts 1-4 in section B.

2. Change input and output paths in the crop_DIV2K_valid_data file (Diffusion_model_and_other_thesis_files -> Thesis). The input path should be the path to your high-resolution dataset and the output paths should lead to any folder(s) where you want to save two different sized low-resolution datasets. The name of the file includes the name of the test set dataset originally used in project.

3. Run the "Cropped low-resolution DIV2K_valid dataset" section in Preparing_high_low_and_cropped_datasets file (Meta files for running Python files folder) to achieve the two different sized low-resolution datasets based on your high-resolution dataset.

4. Run diffusion model as described in parts 5-6 in section B. **NOTICE:**
	- You need to give the low-resolution dataset that has size 128x128 and that has been created in the previous part (3) as input for the diffusion model.
	- You need to replace the paths in the seesr_with_ccsr_vae_cropped_data file (Diffusion_model_and_other_thesis_files -> Thesis) instead of the seesr_with_ccsr_vae file and run "SeeSR with CCSR VAE Using Cropped Data" instead of "SeeSR with CCSR VAE" in the file_for_running_seesr_versions file (Meta files for running Python files folder).

5. Change input paths in the calculate_diffusion_metrics and calculate_niqe files (Diffusion_model_and_other_thesis_files -> Thesis). The input paths should be the paths to your the low-resolution dataset that has size 128x128 and the dataset generated by the diffusion model in previous part 4. The output paths should lead to any folder(s) where you want to save the evaluation results.

### NOTICE!

1. The seesr_with_ccsr_vae_test_img file is the same as seesr_with_ccsr_vae expect the input and output file paths. The point of this file was to work as an extra piece from which I received some example image for my thesis.

2. The test_seesr_changed_for_thesis file is the same as the original test_seesr except it has been made to work with the needed changes for the SeeSR files and its given input and output paths has been changed. The point of this file was to work as an extra piece from which I received some example image for my thesis.

## Acknowledgements
The diffusion model used in this Master's Thesis project is based on [SeeSR](https://github.com/cswry/SeeSR) and [CCSR](https://github.com/csslc/CCSR?tab=readme-ov-file).
1. [SeeSR](https://github.com/cswry/SeeSR) diffusion model has been made by Rongyuan Wu et al. in "SeeSR: Towards Semantics-Aware Real-World Image Super-Resolution (CVPR2024)" web page in Github.

2. [CCSR](https://github.com/csslc/CCSR?tab=readme-ov-file) has been made by Lingchen Sun et al. and it can be found from Github page called "CCSR Improving the Stability and Efficiency of Diffusion Models for Content Consistent Super-Resolution". Specifically, CCSR-v2 is used.

## Citation
If you utilize this project or this thesis, please cite them as follows:

Super-Resolution Diffusion Model as a Data Augmentation Method in Convolutional Neural Networks 
Oona Leppänen
November, 2025
University of Turku
Master's Thesis: 
Code of the Master's Thesis: https://github.com/Oona-Leppanen/SR-Diffusion-Model-as-a-Data-Augmentation-Method-in-CNN

## Licence
This project has been released under the [Apache-2.0 licence](https://github.com/Oona-Leppanen/SR-Diffusion-Model-as-a-Data-Augmentation-Method-in-CNN?tab=Apache-2.0-1-ov-file).
